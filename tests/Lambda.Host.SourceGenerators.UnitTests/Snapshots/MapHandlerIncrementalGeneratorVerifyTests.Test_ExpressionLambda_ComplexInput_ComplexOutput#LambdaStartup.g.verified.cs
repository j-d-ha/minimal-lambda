//HintName: LambdaStartup.g.cs
// <auto-generated>
//     Generated by the Lambda.Host source generator.
// </auto-generated>

#pragma warning disable CS1998 // Async method lacks 'await' operators and will run synchronously

#nullable enable

namespace Tests;

public class LambdaApplication : global::Lambda.Host.LambdaHostedService
{
    public LambdaApplication(
        global::Microsoft.Extensions.Options.IOptions<global::Lambda.Host.LambdaHostSettings> lambdaHostSettings,
        global::Lambda.Host.DelegateHolder delegateHolder,
        global::System.IServiceProvider serviceProvider,
        global::Lambda.Host.Interfaces.ILambdaCancellationTokenSourceFactory lambdaCancellationTokenSourceFactory
    )
        : base(
            lambdaHostSettings,
            delegateHolder,
            serviceProvider,
            lambdaCancellationTokenSourceFactory
        ) { }
    
    public override global::System.Threading.Tasks.Task StartAsync(global::System.Threading.CancellationToken cancellationToken)
    {
        if (!this.DelegateHolder.IsHandlerSet)
            throw new global::System.InvalidOperationException("Handler is not set");
            
        if (this.DelegateHolder.Handler is not global::System.Func<global::CustomRequest, global::IService, global::Amazon.Lambda.Core.ILambdaContext, global::System.Threading.Tasks.Task<global::CustomResponse>> lambdaHandler)
            throw new global::System.InvalidOperationException("Invalid handler type.");
            
        global::Amazon.Lambda.RuntimeSupport.LambdaBootstrapBuilder
            .Create(
                async (global::CustomRequest request, global::Amazon.Lambda.Core.ILambdaContext context) => 
                {
                    using var __scope = global::Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.CreateScope(this.ServiceProvider);
                    
                    var service = global::Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService<global::IService>(__scope.ServiceProvider);
                    
                    var __response = await lambdaHandler(request, service, context);
                    
                    return __response;
                },
                this.LambdaHostSettings.LambdaSerializer
            )
            .Build()
            .RunAsync(cancellationToken);
        
        return global::System.Threading.Tasks.Task.CompletedTask;
    }
}