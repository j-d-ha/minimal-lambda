version: '3'

vars:
  NUGET_API: https://api.nuget.org/v3-flatcontainer
  
includes:
  build: BuildTasks.yml

tasks:
  validate_version:
    desc: Check that package version does not already exist on NuGet
    silent: true
    cmds:
      - echo "ðŸ“‹ Validating version for {{.DIR}}"
      - bash ./scripts/validate-version.sh '{{.DIR}}'

  publish:
    desc: Publish the NuGet package to NuGet.org
    silent: true
    cmds:
      - echo "ðŸš€ Publishing"
      - dotnet nuget push ./nupkg/*.nupkg --source https://api.nuget.org/v3/index.json --api-key $NUGET_API_KEY --skip-duplicate
      - echo "âœ¨ Published"

  publish-all:
    desc: Pack, validate versions, and publish all packages (Host, Abstractions, OpenTelemetry)
    silent: true
    cmds:
      - echo "ðŸ”„ Starting publish-all workflow"
      - task: build:pack
      - echo "ðŸš€ Publishing all packages"
      - task: publish
      - echo "âœ¨ All packages published successfully!"
